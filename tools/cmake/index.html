<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>CMake - Programming and Software Notes</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "CMake";
        var mkdocs_page_input_path = "tools/cmake.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Programming and Software Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../documentation/mkdocs/">MkDocs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../documentation/sphinx/">Sphinx</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../documentation/doxygen/">Doxygen</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../documentation/latex/">LaTeX</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">GMT</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../gmt/gmt5/">GMT5</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gmt/gmt6/">GMT6</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../gmt/pygmt/">pyGMT</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Seismology</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../seismology/data_requests/">Data requests</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../seismology/seisan/">SEISAN</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../seismology/obspy/">ObsPy</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Programming</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../programming/cuda/">CUDA</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../docker/">Docker</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">CMake</a>
    <ul class="current">
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../git/">Git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../parallel/">Parallel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tmux/">tmux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../vim/">vim</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Unix</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../unix/admin/">Admin</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../unix/commands/">Commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../unix/dotfiles/">Dotfiles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../unix/installation/">Installation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">macOS</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/sonoma/">Sonoma installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/ventura/">Ventura installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/macports/">MacPorts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/python/">Python installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/tips/">Tips</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/installation/">Installation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../macos/admin/">Admin</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Programming and Software Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tools</li>
      <li class="breadcrumb-item active">CMake</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cmake">CMake</h1>
<p>Python: needed for testing (?)
BLAS and LAPACK
MPI (OpenMPI)
Eigen linear algebra template library
Boost libraries (Filesystem, Python &amp; Test)</p>
<p>Eigen</p>
<pre><code>$ cd
$ cd src
$ mkdir -p eigen
$ curl -Ls http://bitbucket.org/eigen/eigen/get/3.3.4.tar.gz | tar -xz -C eigen --strip-components=1
$ CC=gcc FC=gfortran cmake -H. -Bbuild_eigen -DCMAKE_INSTALL_PREFIX="$HOME/src/eigen"
[lots of warning, errors?]
</code></pre>
<p>Get information:</p>
<pre><code>$ cmake --help
$ cmake --build . --target help
$ cmake --system-information [logfile] # lots of output, so better write to a file
$ cmake --build build_eigen -- install &gt; install.log 2&gt; install.err
</code></pre>
<p>Generators:</p>
<p>Makefiles, Ninja, Visual Studio, ...</p>
<pre><code>$ cmake --help
.
.
.
Generators

The following generators are available on this platform:
  Unix Makefiles               = Generates standard UNIX makefiles.
  Ninja                        = Generates build.ninja files.
  Xcode                        = Generate Xcode project files.
  CodeBlocks - Ninja           = Generates CodeBlocks project files.
  CodeBlocks - Unix Makefiles  = Generates CodeBlocks project files.
  CodeLite - Ninja             = Generates CodeLite project files.
  CodeLite - Unix Makefiles    = Generates CodeLite project files.
  Sublime Text 2 - Ninja       = Generates Sublime Text 2 project files.
  Sublime Text 2 - Unix Makefiles
                               = Generates Sublime Text 2 project files.
  Kate - Ninja                 = Generates Kate project files.
  Kate - Unix Makefiles        = Generates Kate project files.
  Eclipse CDT4 - Ninja         = Generates Eclipse CDT 4.0 project files.
  Eclipse CDT4 - Unix Makefiles= Generates Eclipse CDT 4.0 project files.
</code></pre>
<p>Minimum <code>CMakeLists.txt</code>:</p>
<pre><code>cmake_minimum_required(VERSION 3.5 FATAL_ERROR)
project(test_project LANGUAGES CXX)
add_executable(hello-world hello-world.cpp)
</code></pre>
<p>Commands for "in-source" build:</p>
<pre><code>$ cmake .
$ cmake --build .
</code></pre>
<p>Commands for "out-of-source" build:</p>
<pre><code>$ mkdir -p build &amp;&amp; cd build
$ cmake ..
$ cmake --build .
</code></pre>
<p>[non-standard alternative from "root" directory: $ cmake -H. -Bbuild ]</p>
<p>Options for "build"</p>
<pre><code>$ cmake --build . --target help
The following are some of the valid targets for this Makefile:
... all (the default if no target is provided)
... clean
... depend
... rebuild_cache
... edit_cache
... getjul                      # this is one of the executables defined in CMakeLists.txt
</code></pre>
<p>[for more advanced projects, also "test", "install", and "package" ]</p>
<p>How to invoke explicitly a generator:</p>
<pre><code>$ cmake -G Ninja ..
</code></pre>
<p>Link with a static library:</p>
<pre><code>add_library(library_name STATIC header_files.hpp source_files.cpp)
target_link_libraries(executable library_name)
</code></pre>
<p>Build directory will contain: lib{library_name}.a</p>
<p>Possible values:
STATIC
SHARED
OBJECT
MODULE</p>
<p>IMPORTED    = a library located outside the project (e.g. FFTW3?)
INTERFACE
ALIAS</p>
<p>Define, set and output variables:</p>
<pre><code>set(USE_LIBRARY OFF)
message(STATUS "Compile sources into a library? ${USE_LIBRARY}")
message("Compile sources into a library? ${USE_LIBRARY}")
</code></pre>
<pre><code class="language-console">$ cmake .
.
.
.
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Compile sources into a library? OFF
Compile sources into a library? OFF
-- Configuring done
-- Generating done
...
</code></pre>
<p>Specifying compiler:</p>
<pre><code>$ cmake -D CMAKE_CXX_COMPILER=clang++ ...   # recommended !!!
</code></pre>
<p>or</p>
<pre><code>$ env CXX=clang++ cmake ...
</code></pre>
<p>but also inside <code>CMakeLists.txt</code></p>
<pre><code>set(CMAKE_CXX_COMPILER "/usr/local/bin/g++")  # before defining project!!!
</code></pre>
<p>Build types:</p>
<p>Debug, Release, RelWithDebInfo, MinSizeRel</p>
<pre><code>set(CMAKE_BUILD_TYPE Debug)
</code></pre>
<p>or</p>
<pre><code>$ cmake -D CMAKE_BUILD_TYPE=Debug ...
</code></pre>
<p>Set compiler and compiler options:</p>
<p>OPTIONS:</p>
<pre><code>list(APPEND flags "-fPIC" "-Wall")
add_library(library_name STATIC header_files.hpp source_files.cpp)
target_compile_options(library_name PRIVATE ${flags})
target_compile_options(execuatable_name PRIVATE "-fPIC")

target_link_libraries(executable_name library_name)

set_target_properties(animals PROPERTIES CXX_STANDARD 14 CXX_EXTENSIONS OFF CXX_STANDARD_REQUIRED ON POSITION_INDEPENDENT_CODE 1)
</code></pre>
<p>also</p>
<pre><code>set(CMAKE_CXX_STANDARD 11)
set(CMAKE_CXX_EXTENSIONS OFF)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
</code></pre>
<p>Discovering system information:</p>
<ul>
<li>Compiler ID</li>
<li>Processor architecture</li>
<li>
<p>Processor instruction set</p>
<p>message(STATUS "Configuring on/for ${CMAKE_SYSTEM_NAME}")  # must be after "project"!!!</p>
<p>CMAKE_CXX_COMPILER_ID</p>
<p>find_package(Eigen3 3.3 REQUIRED CONFIG)</p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../docker/" class="btn btn-neutral float-left" title="Docker"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../git/" class="btn btn-neutral float-right" title="Git">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../docker/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../git/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
